# 套装LORE实时更新功能说明

## 🎯 功能概述

本次改进实现了套装装备LORE的实时状态更新功能，玩家装备套装时，装备的描述会动态显示当前套装激活状态，如 `[0/4]`、`[2/4]`、`[4/4]` 等。

## ✨ 主要改进

### 1. 动态套装总数计算
- **之前**: 硬编码 `/4`，所有套装都显示为4件套
- **现在**: 根据配置文件中的 `pieces` 节点动态计算套装总件数
- **支持**: 2件套、3件套、4件套、5件套等任意件数的套装

### 2. 实时LORE状态更新
- **触发时机**: 
  - 玩家加入服务器时
  - 装备栏物品变化时
  - 背包点击操作时
  - 手持物品切换时
- **更新范围**: 所有装备栏中的套装物品同时更新

### 3. 智能状态识别
- **零件套处理**: 当玩家没有装备任何套装件时，显示 `(0/X)`
- **部分激活**: 装备部分套装件时，显示实际件数，如 `(2/4)`
- **完整激活**: 装备全套时，显示 `(4/4)`

## 🔧 技术实现

### 新增方法

#### SetData.java
```java
// 获取套装总件数
public int getTotalPieces()

// 获取最大激活件数
public int getMaxActivePieces()
```

#### SetManager.java
```java
// 更新所有套装LORE显示
private void updateAllSetLoreForPlayer(Player player, Map<String, Integer> setPieceCounts)

// 更新单个物品套装LORE
private boolean updateItemSetLore(ItemMeta meta, SetData setData, int currentPieceCount, int totalPieces)

// 公共更新方法
public void updatePlayerSetLore(Player player)
```

#### SetListener.java
```java
// 玩家加入事件监听
@EventHandler onPlayerJoin(PlayerJoinEvent event)

// 背包点击事件监听
@EventHandler onInventoryClick(InventoryClickEvent event)

// 手持物品切换事件监听
@EventHandler onPlayerItemHeld(PlayerItemHeldEvent event)
```

## 📝 配置示例

### 支持不同件数的套装配置

```yaml
# 4件套示例
dragon_set:
  name: "龙之套装"
  pieces:
    helmet: "§c[龙之头盔]"
    chestplate: "§c[龙之胸甲]"
    leggings: "§c[龙之护腿]"
    boots: "§c[龙之靴子]"
  attributes:
    2: ["物理伤害: 10", "暴击几率: 5%"]
    4: ["物理伤害: 25", "暴击几率: 15%", "生命上限: 200"]

# 3件套示例
mage_set:
  name: "法师套装"
  pieces:
    helmet: "§9[法师帽]"
    chestplate: "§9[法师袍]"
    leggings: "§9[法师裤]"
  attributes:
    2: ["魔法伤害: 15", "魔法值上限: 100"]
    3: ["魔法伤害: 30", "魔法值上限: 200", "魔法恢复: 10"]
```

## 🎮 用户体验

### LORE显示效果

**装备前**:
```
§c[龙之头盔]
§6品质等级: §c传说
§6物品类型: 头盔
§c龙之套装 (0/4)
```

**装备2件后**:
```
§c[龙之头盔]
§6品质等级: §c传说
§6物品类型: 头盔
§c龙之套装 (2/4)
```

**装备全套后**:
```
§c[龙之头盔]
§6品质等级: §c传说
§6物品类型: 头盔
§c龙之套装 (4/4)
```

## 🔄 更新机制

### 自动更新触发
1. **玩家加入**: 延迟1tick后更新，确保数据完全加载
2. **装备变化**: 监听装备槽位(36-39)的点击操作
3. **实时同步**: 所有套装物品同时更新状态

### 性能优化
- **批量更新**: 一次操作更新所有相关物品
- **延迟执行**: 使用1tick延迟确保操作完成
- **条件检查**: 只在必要时进行更新操作

## 🛡️ 兼容性

### 向后兼容
- **现有配置**: 完全兼容现有套装配置文件
- **API接口**: 保持原有API接口不变
- **功能扩展**: 在原有功能基础上增强

### 多套装支持
- **同时装备**: 支持同时装备多个不同套装
- **独立计算**: 每个套装独立计算和显示状态
- **混合效果**: 不同套装效果可以同时生效

## 📊 测试建议

### 功能测试
1. **基础测试**: 装备/卸下单件套装物品
2. **混合测试**: 同时装备多个套装的物品
3. **边界测试**: 测试0件套、满件套的显示
4. **动态测试**: 在游戏中实时切换装备

### 性能测试
1. **多玩家**: 测试多玩家同时装备变化
2. **频繁操作**: 测试快速装备切换的响应
3. **服务器负载**: 监控更新操作对服务器性能的影响

## 🎉 总结

通过本次改进，套装系统现在具备了：
- ✅ 动态LORE状态显示
- ✅ 实时装备变化响应  
- ✅ 灵活的套装件数支持
- ✅ 优秀的用户体验
- ✅ 良好的性能表现

这些改进让玩家能够清楚地看到当前套装的激活状态，提升了游戏体验的直观性和互动性。
